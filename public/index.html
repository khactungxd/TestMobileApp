<!DOCTYPE html>
<html class="ui-mobile-rendering">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css">
    <script src="js/jquery-1.7.1.min.js"></script>
    <script src="js/jquery.mobile-1.4.2.min.js"></script>
    <script src="js/iscroll.js"></script>
    <script src="js/drawSegmentSelected.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <script type="text/javascript">
        var myScroll;
        function loaded() {
            myScroll = new iScroll('wrapper', { zoom: true, zoomMax: 6 });
        }
        document.addEventListener('DOMContentLoaded', loaded, false);
    </script>
</head>
<body>
    <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1>header</h1>
    </div>
    <div data-scroll="false" id="wrapper" style="position:relative;height: 2000px; width: 99%">
        <img tyle="position:absolute" src="images/Hydrangeas.jpg" alt="">
        <div id="segment-selected" style="position:absolute"></div>
    </div>
    <p id="pos-x"></p>
    <p id="pos-y"></p>
    <p id="zoomed"></p>
    <p id="x-touch"></p>
    <p id="y-touch"></p>
    <div data-role="footer" data-position="fixed" data-tap-toggle="false">
        <h1>footer</h1>
    </div>
</body>
<script>loaded();</script>
<script>
    $(document).ready(function () {
        $(document).bind('touchmove', function(e) {
            e.preventDefault();
        });

        $('#wrapper img').bind('touchmove', function(e) {
            console.log(e);
            $.ajax({
                url: "http://localhost:3200/touchmove",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ClientWidth: e.currentTarget.ClientWidth, ClientHeight: e.currentTarget.ClientHeight, ClientTop: e.currentTarget.ClientTop, ClientLeft: e.currentTarget.ClientLeft}),
                success: function(data) {
                    console.log(data);
                    console.log('process sucess');
                },

                error: function() {
                    console.log('process error');
                }
            });
        });

        $('#wrapper img').bind('click', function(event){
            $.ajax({
                url: "http://localhost:3200/touchimage",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({x: event.clientX, y: event.clientY}),
                success: function(data) {
                    console.log(data);
                    console.log('process sucess');
                },

                error: function() {
                    console.log('process error');
                }
            });

            var scale = $("#zoomed").text();
            if(scale=="") scale = 1;
            var xDiv = event.clientX - $('#wrapper').position().left;
            var yDiv = event.clientY - $('#wrapper').position().top;
            var xOImage = $("#pos-x").text();
            var yOImage = $("#pos-y").text();
            if(xOImage=="") xOImage=0;
            if(yOImage=="") yOImage=0;

            var xImage = Math.floor((parseFloat(xDiv) - parseFloat(xOImage))/parseFloat(scale));
            var yImage = Math.floor((parseFloat(yDiv) - parseFloat(yOImage))/parseFloat(scale));
            $('#x-touch').text("x-touched: "+ xImage.toString());
            $('#y-touch').text("y-touched: "+ yImage.toString());

            var touchInfo = {
                scale: scale,
                xImageTouch: xImage,
                yImageTouch: yImage,
                xDiv: xDiv,
                yDiv: yDiv,
                xOImage: xOImage,
                yOImage: yOImage
            }
            drawSegment(touchInfo);
        })
    });

</script>
</html>